"use strict";(globalThis.webpackChunkai_native_robotics_textbook=globalThis.webpackChunkai_native_robotics_textbook||[]).push([[5665],{3270:(n,e,r)=>{r.r(e),r.d(e,{assets:()=>c,contentTitle:()=>l,default:()=>u,frontMatter:()=>i,metadata:()=>a,toc:()=>d});const a=JSON.parse('{"id":"module-1-robotic-nervous-system/ch5-building-launching-packages","title":"ch5-building-launching-packages","description":"-----","source":"@site/docs/module-1-robotic-nervous-system/ch5-building-launching-packages.md","sourceDirName":"module-1-robotic-nervous-system","slug":"/module-1-robotic-nervous-system/ch5-building-launching-packages","permalink":"/physical-ai-textbook-2025/docs/module-1-robotic-nervous-system/ch5-building-launching-packages","draft":false,"unlisted":false,"editUrl":"https://github.com/Tayyaba10/physical-ai-textbook-2025/edit/main/docs/module-1-robotic-nervous-system/ch5-building-launching-packages.md","tags":[],"version":"current","frontMatter":{},"sidebar":"docs","previous":{"title":"ch4-urdf-xacro-modeling","permalink":"/physical-ai-textbook-2025/docs/module-1-robotic-nervous-system/ch4-urdf-xacro-modeling"},"next":{"title":"ch6-physics-simulation","permalink":"/physical-ai-textbook-2025/docs/module-2-digital-twin/ch6-physics-simulation"}}');var s=r(4848),o=r(8453),t=r(7242);const i={},l=void 0,c={},d=[{value:"title: Ch5  Building &amp; Launching ROS 2 Packages\r\nmodule: 1\r\nchapter: 5\r\nsidebar_label: Ch5: Building &amp; Launching ROS 2 Packages\r\ndescription: Managing ROS 2 packages, building systems, and launch configurations\r\ntags: [ros2, packages, building, launch, cmake, ament]\r\ndifficulty: intermediate\r\nestimated_duration: 60",id:"title-ch5--building--launching-ros-2-packagesmodule-1chapter-5sidebar_label-ch5-building--launching-ros-2-packagesdescription-managing-ros-2-packages-building-systems-and-launch-configurationstags-ros2-packages-building-launch-cmake-amentdifficulty-intermediateestimated_duration-60",level:2},{value:"Learning Outcomes",id:"learning-outcomes",level:2},{value:"Theory",id:"theory",level:2},{value:"Package Structure in ROS 2",id:"package-structure-in-ros-2",level:3},{value:"Build Systems in ROS 2",id:"build-systems-in-ros-2",level:3},{value:"Launch System",id:"launch-system",level:3},{value:"StepbyStep Labs",id:"stepbystep-labs",level:2},{value:"Lab 1: Creating a Complex Package with Multiple Components",id:"lab-1-creating-a-complex-package-with-multiple-components",level:3},{value:"Lab 2: Configuring CMakeLists.txt for Complex Package",id:"lab-2-configuring-cmakeliststxt-for-complex-package",level:3},{value:"Lab 3: Creating Launch Files",id:"lab-3-creating-launch-files",level:3},{value:"Lab 4: Building and Running the Package",id:"lab-4-building-and-running-the-package",level:3},{value:"Runnable Code Example",id:"runnable-code-example",level:2},{value:"Miniproject",id:"miniproject",level:2},{value:"Summary",id:"summary",level:2}];function m(n){const e={code:"code",h1:"h1",h2:"h2",h3:"h3",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,o.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"title-ch5--building--launching-ros-2-packagesmodule-1chapter-5sidebar_label-ch5-building--launching-ros-2-packagesdescription-managing-ros-2-packages-building-systems-and-launch-configurationstags-ros2-packages-building-launch-cmake-amentdifficulty-intermediateestimated_duration-60",children:"title: Ch5  Building & Launching ROS 2 Packages\r\nmodule: 1\r\nchapter: 5\r\nsidebar_label: Ch5: Building & Launching ROS 2 Packages\r\ndescription: Managing ROS 2 packages, building systems, and launch configurations\r\ntags: [ros2, packages, building, launch, cmake, ament]\r\ndifficulty: intermediate\r\nestimated_duration: 60"}),"\n","\n",(0,s.jsx)(e.h1,{id:"building--launching-ros-2-packages",children:"Building & Launching ROS 2 Packages"}),"\n",(0,s.jsx)(e.h2,{id:"learning-outcomes",children:"Learning Outcomes"}),"\n",(0,s.jsx)(e.p,{children:"Understand the structure and organization of ROS 2 packages\r\nCreate and manage packages using colcon build system\r\nConfigure CMakeLists.txt and package.xml for different build types\r\nCreate launch files to start multiple nodes with parameters\r\nUse launch arguments and conditional launching\r\nIntegrate thirdparty libraries into ROS 2 packages\r\nDeploy packages to different environments"}),"\n",(0,s.jsx)(e.h2,{id:"theory",children:"Theory"}),"\n",(0,s.jsx)(e.h3,{id:"package-structure-in-ros-2",children:"Package Structure in ROS 2"}),"\n",(0,s.jsx)(e.p,{children:"ROS 2 packages follow a standardized structure that enables consistent building and deployment across different systems. The package is the basic unit of code organization in ROS 2."}),"\n",(0,s.jsx)(t.A,{chart:"\ngraph TD;\n  A[ROS 2 Package] > B[package.xml];\n  A > C[CMakeLists.txt];\n  A > D[src/];\n  A > E[include/];\n  A > F[launch/];\n  A > G[config/];\n  A > H[rviz/];\n  A > I[urdf/];\n  A > J[params/];\n  \n  D > K[Node Source Files];\n  E > L[Header Files];\n  F > M[Launch Files];\n  G > N[Configuration Files];\n  I > O[URDF/Xacro Files];\n  \n  style A fill:#4CAF50,stroke:#388E3C,color:#fff;\n  style B fill:#2196F3,stroke:#0D47A1,color:#fff;\n  style C fill:#2196F3,stroke:#0D47A1,color:#fff;\n"}),"\n",(0,s.jsx)(e.h3,{id:"build-systems-in-ros-2",children:"Build Systems in ROS 2"}),"\n",(0,s.jsxs)(e.p,{children:["ROS 2 uses the ",(0,s.jsx)(e.code,{children:"colcon"})," build system, which is a commandline tool that provides a unified interface for building different types of packages (CMake, Python, etc.) in a workspace. The primary build systems are:\r\n",(0,s.jsx)(e.code,{children:"ament_cmake"})," for C++ packages\r\n",(0,s.jsx)(e.code,{children:"ament_python"})," for Python packages\r\n",(0,s.jsx)(e.code,{children:"ament_cmake_python"})," for mixed C++/Python packages"]}),"\n",(0,s.jsx)(e.h3,{id:"launch-system",children:"Launch System"}),"\n",(0,s.jsx)(e.p,{children:"The ROS 2 launch system uses Python files instead of XML (as in ROS 1) to provide more flexibility and powerful features such as:\r\nConditional launching\r\nLaunch arguments\r\nNode composition\r\nEvent handling"}),"\n",(0,s.jsx)(e.h2,{id:"stepbystep-labs",children:"StepbyStep Labs"}),"\n",(0,s.jsx)(e.h3,{id:"lab-1-creating-a-complex-package-with-multiple-components",children:"Lab 1: Creating a Complex Package with Multiple Components"}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Create a comprehensive package"})," with both C++ and Python nodes:"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"cd ~/ros2_ws/src\r\nros2 pkg create buildtype ament_cmake dependencies rclcpp rclpy std_msgs geometry_msgs sensor_msgs example_interfaces complex_robot_controller\r\ncd complex_robot_controller\n"})}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Create directory structure"}),":"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"mkdir p src include launch config\n"})}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Update package.xml"})," to include all dependencies:"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-xml",children:'<?xml version="1.0"?>\r\n<?xmlmodel href="http://download.ros.org/schema/package_format3.xsd" schematypens="http://www.w3.org/2001/XMLSchema"?>\r\n<package format="3">\r\n  <name>complex_robot_controller</name>\r\n  <version>0.0.0</version>\r\n  <description>Complex robot controller with multiple components</description>\r\n  <maintainer email="user@todo.todo">Your Name</maintainer>\r\n  <license>Apache License 2.0</license>\r\n\r\n  <buildtool_depend>ament_cmake</buildtool_depend>\r\n\r\n  <depend>rclcpp</depend>\r\n  <depend>rclpy</depend>\r\n  <depend>std_msgs</depend>\r\n  <depend>geometry_msgs</depend>\r\n  <depend>sensor_msgs</depend>\r\n  <depend>example_interfaces</depend>\r\n  <depend>launch</depend>\r\n  <depend>launch_ros</depend>\r\n\r\n  <test_depend>ament_lint_auto</test_depend>\r\n  <test_depend>ament_lint_common</test_depend>\r\n\r\n  <export>\r\n    <build_type>ament_cmake</build_type>\r\n  </export>\r\n</package>\n'})}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Create C++ header file"})," (",(0,s.jsx)(e.code,{children:"include/complex_robot_controller/motion_controller.hpp"}),"):"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:'#ifndef MOTION_CONTROLLER_HPP_\r\n#define MOTION_CONTROLLER_HPP_\r\n\r\n#include "rclcpp/rclcpp.hpp"\r\n#include "geometry_msgs/msg/twist.hpp"\r\n#include "std_msgs/msg/float64.hpp"\r\n#include "sensor_msgs/msg/laser_scan.hpp"\r\n\r\nnamespace complex_robot_controller\r\n{\r\n  class MotionController : public rclcpp::Node\r\n  {\r\n  public:\r\n    MotionController();\r\n    \r\n  private:\r\n    void scan_callback(const sensor_msgs::msg::LaserScan::SharedPtr msg);\r\n    void safety_timer_callback();\r\n    \r\n    rclcpp::Publisher<geometry_msgs::msg::Twist>::SharedPtr cmd_vel_pub_;\r\n    rclcpp::Subscription<sensor_msgs::msg::LaserScan>::SharedPtr scan_sub_;\r\n    rclcpp::TimerBase::SharedPtr safety_timer_;\r\n    \r\n    double linear_vel_;\r\n    double angular_vel_;\r\n    bool obstacle_detected_;\r\n    double safety_distance_;\r\n  };\r\n}\r\n\r\n#endif  // MOTION_CONTROLLER_HPP_\n'})}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Create C++ implementation"})," (",(0,s.jsx)(e.code,{children:"src/motion_controller.cpp"}),"):"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:'#include "complex_robot_controller/motion_controller.hpp"\r\n#include <cmath>\r\n\r\nnamespace complex_robot_controller\r\n{\r\n  MotionController::MotionController()\r\n  : Node("motion_controller"),\r\n    linear_vel_(0.5),\r\n    angular_vel_(0.5),\r\n    obstacle_detected_(false),\r\n    safety_distance_(0.8)\r\n  {\r\n    cmd_vel_pub_ = this>create_publisher<geometry_msgs::msg::Twist>("cmd_vel", 10);\r\n    scan_sub_ = this>create_subscription<sensor_msgs::msg::LaserScan>(\r\n      "scan", 10, \r\n      std::bind(&MotionController::scan_callback, this, std::placeholders::_1));\r\n    \r\n    safety_timer_ = this>create_wall_timer(\r\n      std::chrono::milliseconds(100),  // 10 Hz\r\n      std::bind(&MotionController::safety_timer_callback, this));\r\n  }\r\n\r\n  void MotionController::scan_callback(const sensor_msgs::msg::LaserScan::SharedPtr msg)\r\n  {\r\n    // Find minimum distance in front of the robot\r\n    float min_distance = std::numeric_limits<float>::max();\r\n    \r\n    // Consider only the front 90 degrees\r\n    int start_idx = msg>ranges.size() / 2  45;\r\n    int end_idx = msg>ranges.size() / 2 + 45;\r\n    \r\n    for (int i = start_idx; i < end_idx && i < msg>ranges.size(); ++i) {\r\n      if (msg>ranges[i] < min_distance && !std::isinf(msg>ranges[i]) && !std::isnan(msg>ranges[i])) {\r\n        min_distance = msg>ranges[i];\r\n      }\r\n    }\r\n    \r\n    obstacle_detected_ = (min_distance < safety_distance_);\r\n  }\r\n\r\n  void MotionController::safety_timer_callback()\r\n  {\r\n    auto cmd_msg = geometry_msgs::msg::Twist();\r\n    \r\n    if (obstacle_detected_) {\r\n      // Stop and rotate away from obstacle\r\n      cmd_msg.linear.x = 0.0;\r\n      cmd_msg.angular.z = angular_vel_;\r\n      RCLCPP_WARN(this>get_logger(), "Obstacle detected! Rotating away.");\r\n    } else {\r\n      // Move forward\r\n      cmd_msg.linear.x = linear_vel_;\r\n      cmd_msg.angular.z = 0.0;\r\n    }\r\n    \r\n    cmd_vel_pub_>publish(cmd_msg);\r\n  }\r\n}\r\n\r\nint main(int argc, char * argv[])\r\n{\r\n  rclcpp::init(argc, argv);\r\n  rclcpp::spin(std::make_shared<complex_robot_controller::MotionController>());\r\n  rclcpp::shutdown();\r\n  return 0;\r\n}\n'})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"lab-2-configuring-cmakeliststxt-for-complex-package",children:"Lab 2: Configuring CMakeLists.txt for Complex Package"}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Update CMakeLists.txt"}),":","\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cmake",children:'cmake_minimum_required(VERSION 3.8)\r\nproject(complex_robot_controller)\r\n\r\nif(CMAKE_COMPILER_IS_GNUCXX OR CMAKE_CXX_COMPILER_ID MATCHES "Clang")\r\n  add_compile_options(Wall Wextra Wpedantic)\r\nendif()\r\n\r\n# Find dependencies\r\nfind_package(ament_cmake REQUIRED)\r\nfind_package(rclcpp REQUIRED)\r\nfind_package(rclpy REQUIRED)\r\nfind_package(std_msgs REQUIRED)\r\nfind_package(geometry_msgs REQUIRED)\r\nfind_package(sensor_msgs REQUIRED)\r\nfind_package(example_interfaces REQUIRED)\r\n\r\n# Include header directories\r\ninclude_directories(include)\r\n\r\n# Create executable\r\nadd_executable(motion_controller src/motion_controller.cpp)\r\nament_target_dependencies(motion_controller \r\n  rclcpp \r\n  std_msgs \r\n  geometry_msgs \r\n  sensor_msgs)\r\n\r\n# Install executables\r\ninstall(TARGETS\r\n  motion_controller\r\n  DESTINATION lib/${PROJECT_NAME})\r\n\r\n# Install launch files\r\ninstall(DIRECTORY\r\n  launch\r\n  config\r\n  DESTINATION share/${PROJECT_NAME}/\r\n)\r\n\r\nament_package()\n'})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"lab-3-creating-launch-files",children:"Lab 3: Creating Launch Files"}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Create a launch file"})," (",(0,s.jsx)(e.code,{children:"launch/robot_system.launch.py"}),"):"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-python",children:"import os\r\nfrom ament_index_python.packages import get_package_share_directory\r\nfrom launch import LaunchDescription\r\nfrom launch.actions import DeclareLaunchArgument, IncludeLaunchDescription, TimerAction\r\nfrom launch.launch_description_sources import PythonLaunchDescriptionSource\r\nfrom launch.substitutions import LaunchConfiguration\r\nfrom launch_ros.actions import Node, ComposableNodeContainer\r\nfrom launch_ros.descriptions import ComposableNode\r\n\r\n\r\ndef generate_launch_description():\r\n    # Declare launch arguments\r\n    use_sim_time = DeclareLaunchArgument(\r\n        'use_sim_time',\r\n        default_value='false',\r\n        description='Use simulation (Gazebo) clock if true')\r\n        \r\n    robot_namespace = DeclareLaunchArgument(\r\n        'robot_namespace',\r\n        default_value='robot1',\r\n        description='Robot namespace for multirobot systems')\r\n        \r\n    linear_velocity = DeclareLaunchArgument(\r\n        'linear_velocity',\r\n        default_value='0.5',\r\n        description='Linear velocity of the robot')\r\n\r\n    # Create nodes\r\n    motion_controller_node = Node(\r\n        package='complex_robot_controller',\r\n        executable='motion_controller',\r\n        name='motion_controller',\r\n        parameters=[\r\n            {'use_sim_time': LaunchConfiguration('use_sim_time')},\r\n            {'linear_velocity': LaunchConfiguration('linear_velocity')}\r\n        ],\r\n        remappings=[\r\n            ('/cmd_vel', [LaunchConfiguration('robot_namespace'), '/cmd_vel']),\r\n            ('/scan', [LaunchConfiguration('robot_namespace'), '/scan'])\r\n        ],\r\n        output='screen'\r\n    )\r\n\r\n    # Create a diagnostics node\r\n    diagnostics_node = Node(\r\n        package='complex_robot_controller',\r\n        executable='diagnostics_node',  # You would create this separately\r\n        name='diagnostics',\r\n        parameters=[\r\n            {'use_sim_time': LaunchConfiguration('use_sim_time')}\r\n        ],\r\n        output='screen'\r\n    )\r\n\r\n    # Create launch description\r\n    ld = LaunchDescription()\r\n    \r\n    # Add launch arguments\r\n    ld.add_action(use_sim_time)\r\n    ld.add_action(robot_namespace)\r\n    ld.add_action(linear_velocity)\r\n    \r\n    # Add nodes\r\n    ld.add_action(motion_controller_node)\r\n    # ld.add_action(diagnostics_node)  # Uncomment once diagnostics_node exists\r\n    \r\n    return ld\n"})}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Create a launch file for multirobot setup"})," (",(0,s.jsx)(e.code,{children:"launch/multi_robot.launch.py"}),"):"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-python",children:"import os\r\nfrom launch import LaunchDescription\r\nfrom launch.actions import DeclareLaunchArgument, IncludeLaunchDescription, GroupAction\r\nfrom launch.launch_description_sources import PythonLaunchDescriptionSource\r\nfrom launch.substitutions import LaunchConfiguration, TextSubstitution\r\nfrom launch_ros.actions import Node, PushRosNamespace\r\n\r\n\r\ndef generate_launch_description():\r\n    # Declare launch arguments\r\n    use_sim_time = DeclareLaunchArgument(\r\n        'use_sim_time',\r\n        default_value='false',\r\n        description='Use simulation (Gazebo) clock if true')\r\n        \r\n    num_robots = DeclareLaunchArgument(\r\n        'num_robots',\r\n        default_value='2',\r\n        description='Number of robots to launch')\r\n\r\n    # Create a group for each robot\r\n    robot_groups = []\r\n    for i in range(int(LaunchConfiguration('num_robots').perform({}))):\r\n        robot_namespace = f'robot_{i}'\r\n        \r\n        # Create group action for each robot\r\n        robot_group = GroupAction(\r\n            actions=[\r\n                PushRosNamespace(robot_namespace),\r\n                IncludeLaunchDescription(\r\n                    PythonLaunchDescriptionSource(\r\n                        [os.path.join(\r\n                            os.path.dirname(__file__),\r\n                            'robot_system.launch.py'\r\n                        )]\r\n                    ),\r\n                    launch_arguments={\r\n                        'use_sim_time': LaunchConfiguration('use_sim_time'),\r\n                        'robot_namespace': robot_namespace,\r\n                        'linear_velocity': TextSubstitution(text=str(0.3 + i * 0.1))\r\n                    }.items()\r\n                )\r\n            ]\r\n        )\r\n        \r\n        robot_groups.append(robot_group)\r\n\r\n    # Create launch description\r\n    ld = LaunchDescription()\r\n    \r\n    # Add launch arguments\r\n    ld.add_action(use_sim_time)\r\n    ld.add_action(num_robots)\r\n    \r\n    # Add robot groups\r\n    for group in robot_groups:\r\n        ld.add_action(group)\r\n    \r\n    return ld\n"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"lab-4-building-and-running-the-package",children:"Lab 4: Building and Running the Package"}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Build the package"}),":"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"cd ~/ros2_ws\r\ncolcon build packagesselect complex_robot_controller symlinkinstall\n"})}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Source the workspace"}),":"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"source install/setup.bash\n"})}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Run the package"}),":"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"ros2 run complex_robot_controller motion_controller\n"})}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Launch using the launch file"}),":"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"ros2 launch complex_robot_controller robot_system.launch.py\n"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"runnable-code-example",children:"Runnable Code Example"}),"\n",(0,s.jsx)(e.p,{children:"Here's a complete example of a parameterized robot controller with configuration files:"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Configuration file"})," (",(0,s.jsx)(e.code,{children:"config/robot_params.yaml"}),"):"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-yaml",children:"/**:\r\n  ros__parameters:\r\n    use_sim_time: false\r\n    linear_velocity: 0.5\r\n    angular_velocity: 0.3\r\n    safety_distance: 0.8\r\n    controller_freq: 10.0\r\n    max_linear_speed: 1.0\r\n    max_angular_speed: 1.5\r\n    safety_threshold_multiplier: 1.2\n"})}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Complete Python node"})," (",(0,s.jsx)(e.code,{children:"complex_robot_controller/behavior_controller.py"}),"):"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-python",children:"#!/usr/bin/env python3\r\n\r\nimport rclpy\r\nfrom rclpy.node import Node\r\nfrom geometry_msgs.msg import Twist\r\nfrom sensor_msgs.msg import LaserScan\r\nfrom std_msgs.msg import String\r\nimport math\r\nimport time\r\n\r\n\r\nclass BehaviorController(Node):\r\n    def __init__(self):\r\n        super().__init__('behavior_controller')\r\n        \r\n        # Declare parameters with defaults\r\n        self.declare_parameter('linear_velocity', 0.5)\r\n        self.declare_parameter('angular_velocity', 0.3)\r\n        self.declare_parameter('safety_distance', 0.8)\r\n        self.declare_parameter('controller_freq', 10.0)\r\n        self.declare_parameter('behavior_mode', 'explore')  # explore, follow, avoid\r\n        \r\n        # Get parameters\r\n        self.linear_velocity = self.get_parameter('linear_velocity').value\r\n        self.angular_velocity = self.get_parameter('angular_velocity').value\r\n        self.safety_distance = self.get_parameter('safety_distance').value\r\n        self.controller_freq = self.get_parameter('controller_freq').value\r\n        self.behavior_mode = self.get_parameter('behavior_mode').value\r\n        \r\n        # Publishers and subscribers\r\n        self.cmd_pub = self.create_publisher(Twist, 'cmd_vel', 10)\r\n        self.scan_sub = self.create_subscription(\r\n            LaserScan, 'scan', self.scan_callback, 10)\r\n        self.status_pub = self.create_publisher(String, 'robot_status', 10)\r\n        \r\n        # Internal state\r\n        self.obstacle_detected = False\r\n        self.scan_data = None\r\n        \r\n        # Create timer\r\n        self.timer = self.create_timer(1.0/self.controller_freq, self.control_loop)\r\n        \r\n        self.get_logger().info(f'Behavior Controller initialized with mode: {self.behavior_mode}')\r\n        \r\n    def scan_callback(self, msg):\r\n        self.scan_data = msg\r\n        # Process scan data to detect obstacles\r\n        if len(msg.ranges) > 0:\r\n            # Get frontfacing ranges (\xb130 degrees)\r\n            front_ranges = msg.ranges[len(msg.ranges)//2  15 : len(msg.ranges)//2 + 15]\r\n            front_ranges = [r for r in front_ranges if not (math.isinf(r) or math.isnan(r))]\r\n            \r\n            if front_ranges:\r\n                min_distance = min(front_ranges)\r\n                self.obstacle_detected = min_distance < self.safety_distance\r\n            else:\r\n                self.obstacle_detected = False\r\n    \r\n    def control_loop(self):\r\n        cmd = Twist()\r\n        \r\n        if self.scan_data is None:\r\n            self.get_logger().warn('No scan data received yet')\r\n            cmd.linear.x = 0.0\r\n            cmd.angular.z = 0.0\r\n        elif self.behavior_mode == 'explore':\r\n            if self.obstacle_detected:\r\n                cmd.linear.x = 0.0\r\n                cmd.angular.z = self.angular_velocity\r\n                status_msg = String()\r\n                status_msg.data = \"Avoiding obstacle\"\r\n                self.status_pub.publish(status_msg)\r\n            else:\r\n                cmd.linear.x = self.linear_velocity\r\n                cmd.angular.z = 0.0\r\n                status_msg = String()\r\n                status_msg.data = \"Exploring\"\r\n                self.status_pub.publish(status_msg)\r\n        elif self.behavior_mode == 'follow':\r\n            # Simple wallfollowing behavior\r\n            if self.scan_data.ranges:\r\n                right_dist = self.scan_data.ranges[0] if not math.isinf(self.scan_data.ranges[0]) else float('inf')\r\n                front_dist = self.scan_data.ranges[len(self.scan_data.ranges)//2] if not math.isinf(self.scan_data.ranges[len(self.scan_data.ranges)//2]) else float('inf')\r\n                \r\n                if front_dist < self.safety_distance:\r\n                    cmd.angular.z = self.angular_velocity  # Turn left\r\n                elif right_dist > 0.5:  # Too far from wall\r\n                    cmd.angular.z = self.angular_velocity  # Turn right\r\n                elif right_dist < 0.2:  # Too close to wall\r\n                    cmd.angular.z = self.angular_velocity  # Turn left\r\n                else:\r\n                    cmd.linear.x = self.linear_velocity  # Follow wall at distance\r\n        elif self.behavior_mode == 'avoid':\r\n            # More aggressive obstacle avoidance\r\n            if self.obstacle_detected:\r\n                cmd.linear.x = 0.0\r\n                cmd.angular.z = self.angular_velocity * 2.0  # Faster turning\r\n            else:\r\n                cmd.linear.x = self.linear_velocity\r\n                cmd.angular.z = 0.0\r\n        else:\r\n            self.get_logger().warn(f'Unknown behavior mode: {self.behavior_mode}')\r\n            cmd.linear.x = 0.0\r\n            cmd.angular.z = 0.0\r\n        \r\n        self.cmd_pub.publish(cmd)\r\n\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    behavior_controller = BehaviorController()\r\n    \r\n    try:\r\n        rclpy.spin(behavior_controller)\r\n    except KeyboardInterrupt:\r\n        pass\r\n    finally:\r\n        behavior_controller.destroy_node()\r\n        rclpy.shutdown()\r\n\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Launch file with parameters"})," (",(0,s.jsx)(e.code,{children:"launch/behavior.launch.py"}),"):"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-python",children:"import os\r\nfrom ament_index_python.packages import get_package_share_directory\r\nfrom launch import LaunchDescription\r\nfrom launch.actions import DeclareLaunchArgument\r\nfrom launch.substitutions import LaunchConfiguration\r\nfrom launch_ros.actions import Node\r\n\r\n\r\ndef generate_launch_description():\r\n    # Declare launch arguments\r\n    use_sim_time = DeclareLaunchArgument(\r\n        'use_sim_time',\r\n        default_value='false',\r\n        description='Use simulation (Gazebo) clock if true')\r\n    \r\n    linear_velocity = DeclareLaunchArgument(\r\n        'linear_velocity',\r\n        default_value='0.5',\r\n        description='Linear velocity of the robot')\r\n    \r\n    behavior_mode = DeclareLaunchArgument(\r\n        'behavior_mode',\r\n        default_value='explore',\r\n        description='Behavior mode: explore, follow, or avoid')\r\n    \r\n    # Get config file path\r\n    config = os.path.join(\r\n        get_package_share_directory('complex_robot_controller'),\r\n        'config',\r\n        'robot_params.yaml'\r\n    )\r\n    \r\n    # Create behavior controller node\r\n    behavior_controller = Node(\r\n        package='complex_robot_controller',\r\n        executable='behavior_controller',  # This needs to be added as an entry point\r\n        name='behavior_controller',\r\n        parameters=[\r\n            config,\r\n            {'use_sim_time': LaunchConfiguration('use_sim_time')},\r\n            {'linear_velocity': LaunchConfiguration('linear_velocity')},\r\n            {'behavior_mode': LaunchConfiguration('behavior_mode')}\r\n        ],\r\n        remappings=[\r\n            ('/cmd_vel', '/cmd_vel'),\r\n            ('/scan', '/scan')\r\n        ],\r\n        output='screen'\r\n    )\r\n    \r\n    # Create launch description\r\n    ld = LaunchDescription()\r\n    \r\n    # Add launch arguments\r\n    ld.add_action(use_sim_time)\r\n    ld.add_action(linear_velocity)\r\n    ld.add_action(behavior_mode)\r\n    \r\n    # Add nodes\r\n    ld.add_action(behavior_controller)\r\n    \r\n    return ld\n"})}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Update setup.py"})," to include the Python executable:"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-python",children:"from setuptools import setup\r\n\r\npackage_name = 'complex_robot_controller'\r\n\r\nsetup(\r\n    name=package_name,\r\n    version='0.0.0',\r\n    packages=[package_name],\r\n    data_files=[\r\n        ('share/ament_index/resource_index/packages',\r\n            ['resource/' + package_name]),\r\n        ('share/' + package_name, ['package.xml']),\r\n        # Include launch and config files\r\n        ('share/' + package_name + '/launch', \r\n         ['launch/robot_system.launch.py', 'launch/multi_robot.launch.py', 'launch/behavior.launch.py']),\r\n        ('share/' + package_name + '/config', \r\n         ['config/robot_params.yaml']),\r\n    ],\r\n    install_requires=['setuptools'],\r\n    zip_safe=True,\r\n    maintainer='Your Name',\r\n    maintainer_email='your.email@example.com',\r\n    description='Complex robot controller with multiple components',\r\n    license='Apache License 2.0',\r\n    tests_require=['pytest'],\r\n    entry_points={\r\n        'console_scripts': [\r\n            'motion_controller = complex_robot_controller.motion_controller:main',\r\n            'behavior_controller = complex_robot_controller.behavior_controller:main',\r\n        ],\r\n    },\r\n)-\n"})}),"\n",(0,s.jsx)(e.h2,{id:"miniproject",children:"Miniproject"}),"\n",(0,s.jsx)(e.p,{children:"Create a complete navigation stack package with the following components:"}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsx)(e.li,{children:"A path planner node that takes goal poses and computes a path"}),"\n",(0,s.jsx)(e.li,{children:"A local controller that follows the path while avoiding obstacles"}),"\n",(0,s.jsx)(e.li,{children:"A parameter configuration system that allows tuning of navigation parameters"}),"\n",(0,s.jsx)(e.li,{children:"A launch file that starts the entire navigation stack with appropriate parameters"}),"\n",(0,s.jsx)(e.li,{children:"A configuration file in YAML format for all navigation parameters"}),"\n",(0,s.jsx)(e.li,{children:"Proper error handling and logging throughout the system"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"Create a README.md file that explains how to:\r\nBuild the package\r\nLaunch the navigation stack\r\nConfigure different navigation parameters\r\nTest the system with simulated sensor data"}),"\n",(0,s.jsx)(e.h2,{id:"summary",children:"Summary"}),"\n",(0,s.jsx)(e.p,{children:"This chapter covered the complete workflow for building and launching ROS 2 packages:"}),"\n",(0,s.jsx)(e.p,{children:"Package structure organization with proper CMakeLists.txt and package.xml configuration\r\nThe colcon build system for compiling different types of packages\r\nLaunch files using Python for complex system startup\r\nParameter management using YAML configuration files\r\nMultirobot system setup with namespaces\r\nBest practices for package organization and deployment"}),"\n",(0,s.jsx)(e.p,{children:"The launch system in ROS 2 provides powerful features for managing complex robotic systems, allowing for conditional launching, argument passing, and node composition. Properly configured packages with appropriate parameters and launch files are essential for developing robust and maintainable robotics applications."})]})}function u(n={}){const{wrapper:e}={...(0,o.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(m,{...n})}):m(n)}}}]);